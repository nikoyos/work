<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Register/Search Form</title>
<style>
    /* 设置表格的边框样式 */
    table {
        border-collapse: collapse;
        width: 100%;
    }

    /* 设置表头单元格的样式 */
    th {
        border: 1px solid black;
        text-align: center; /* 居中对齐 */
    }

    /* 设置表体单元格的样式 */
    td {
        border: 1px solid black;
        text-align: center; /* 居中对齐 */
    }
</style>
</head>
<body style="padding: 0; margin: 0;">
	<div
		style="width: 100%; background-color: #EEEEEE; border: 1px solid black;">登记通讯录</div>

	<div style="width: 80%; margin: 0 auto; border: 1px solid black;">
		<!-- 搜索和添加 -->
		<div style="background-color: #EEEEEE; border: 1px solid black;">
			<div>详细信息检索</div>
			<form id="registerForm" method="post">
				<div>
					<label for="groupName">所有者组别:</label> <input type="text"
						id="groupName" name="groupName" />
				</div>
				<div>
					<label for="name">通讯录名:</label> <input type="text" id="name"
						name="name" />
				</div>

				<div>
					<label for="registerName">登记者</label> <input type="text"
						id="registerName" name="registerName" />
				</div>

				<div>
					<label for="updateName">更新者</label> <input type="text"
						id="updateName" name="updateName" />
				</div>

				<div>

					<button type="submit" id="searchButton">检索</button>
					<button type="submit" id="addButton">添加</button>
					<p th:text="${result}"></p>


				</div>

			</form>

		</div>

		<!-- 搜索结果 -->
		<div >
			<table style="width: 100%;">
				<thead>
					<tr>
						<th>一览</th>
						<th>编辑</th>
						<th>显示项目</th>
						<th>导出</th>
						<th>通讯录名</th>
						<th>所有者组别名</th>
						<th>更新日时</th>
						<th>删除</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="entity : ${results}">
						<td>XXX</td>
						<td><button class="edit-button">编辑</button></td>
						<td>XXX</td>
						<td>XXX</td>
						<td th:text="${entity.name}"></td>
						<td th:text="${entity.groupName}"></td>
						<td th:text="${entity.updateTime}"></td>
						<td><button id="delete">删除</button></td>
				</tbody>
			</table>
		</div>

		<!-- 编辑框 -->
		<div class="dialog-overlay" id="editDialog" style="display: none">
			<div class="dialog-box">
				<!-- 编辑表单 -->
				<form id="editForm" method="get" action="/register/update">
					<div style="display: none;">
						<label for="oName">原通讯录名：</label> <input type="text" id="oName"
							name="oName" />
					</div>
					<div>
						<label for="editName">通讯录名:</label> <input type="text"
							id="editName" name="editName" />
					</div>
					<div>
						<label for="editGroupName">所有者组别:</label> <input type="text"
							id="editGroupName" name="editGroupName" />
					</div>
					<div>
						<button type="submit" id="editForm">保存</button>
						<button type="button" id="cancelEdit">取消</button>

					</div>
				</form>
			</div>
		</div>

	</div>


	<script>
		//检索和添加
		document
				.getElementById("searchButton")
				.addEventListener(
						"click",
						function() {
							event.preventDefault();
							document.getElementById("registerForm").action = "/register/search";
							document.getElementById("registerForm").submit();

						});

		document
				.getElementById("addButton")
				.addEventListener(
						"click",
						function() {
							event.preventDefault();
							document.getElementById("registerForm").action = "/register/add";
							document.getElementById("registerForm").submit();
						});

		//删除
		var deleteButtons = document.querySelectorAll("#delete");
		deleteButtons.forEach(function(button) {
			button.addEventListener("click", function() {
				var row = this.closest("tr");
				var name = row.cells[4].textContent;

				var params = "?deleteName=" + encodeURIComponent(name);
				var url = "/register/delete" + params;
				console.log(url);

				var xhr = new XMLHttpRequest();
				xhr.open("GET", url, true);
				xhr.setRequestHeader("Content-Type", "application/json");
				xhr.onload = function() {
					if (xhr.status >= 200 && xhr.status < 300) {
						console.log("yes");
						window.location.reload();
					} else {
						console.error('请求失败: ' + xhr.status);
					}
				};
				xhr.send();
			});
		});

		// 编辑
		var editButtons = document.querySelectorAll(".edit-button");
		editButtons.forEach(function(button) {
			button.addEventListener("click", function() {
				var row = this.closest("tr");
				var name = row.cells[4].textContent;
				var groupName = row.cells[5].textContent;

				document.getElementById("oName").value = name;
				document.getElementById("editName").value = name;
				document.getElementById("editGroupName").value = groupName;

				document.getElementById("editDialog").style.display = "flex";
			});
		});

		// 取消编辑按钮点击事件
		document
				.getElementById("cancelEdit")
				.addEventListener(
						"click",
						function() {
							document.getElementById("editDialog").style.display = "none";
						});
	</script>
</body>
</html>
